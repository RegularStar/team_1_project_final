{% extends 'base.html' %}
{% load static %}

{% block title %}SkillBridge 홈{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/home.css' %}" />
{% endblock %}

{% block content %}
  <section class="hero">
    <h2>SkillBridge에 오신 것을 환영합니다.</h2>
    <p>채용공고를 입력하고, 필요한 자격증을 확인해보세요.</p>
    <div class="cta">
      <a class="btn" href="{% url 'job_recommendation' %}">채용공고로 자격증 검색하기</a>
      <a class="btn secondary" href="{% url 'search' %}">자격증 탐색</a>
    </div>
  </section>

  {% if user.is_authenticated %}
    <section class="section section--recommended" id="recommended">
      <div class="section-head">
        <div class="section-title-group">
          <h3 class="section-title">맞춤 추천 자격증</h3>
          {% if interest_keywords %}
            <span class="recommended-keywords">
              {% for tag in interest_keywords|slice:":3" %}
                #{{ tag }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
              {% if interest_keywords|length > 3 %}
                외 {{ interest_keywords|length|add:"-3" }}개
              {% endif %}
            </span>
          {% endif %}
        </div>
        <span class="section-aside">관심 태그 기반 추천</span>
      </div>

      {% if recommended_certificates %}
        <div class="recommended-grid">
          {% for cert in recommended_certificates %}
            <a class="recommended-card" href="/certificates/{{ cert.slug }}/">
              <div class="recommended-card__header">
                <span class="recommended-card__rank">#{{ forloop.counter }}</span>
                {% if cert.match_count %}
                  <span class="recommended-card__match">관심 태그 {{ cert.match_count }}개 일치</span>
                {% endif %}
              </div>
              <h4 class="recommended-card__title">{{ cert.name }}</h4>
              {% if cert.rating is not None %}
                <span class="recommended-card__metric">난이도 {{ cert.rating }}/10</span>
              {% endif %}
              {% if cert.matched_tags %}
                <div class="recommended-card__tags">
                  {% for tag in cert.matched_tags %}
                    <span class="recommended-tag recommended-tag--focus">#{{ tag }}</span>
                  {% endfor %}
                </div>
              {% endif %}
              {% if cert.other_tags %}
                <div class="recommended-card__tags recommended-card__tags--secondary">
                  {% for tag in cert.other_tags %}
                    <span class="recommended-tag">#{{ tag }}</span>
                  {% endfor %}
                </div>
              {% endif %}
            </a>
          {% endfor %}
        </div>
      {% elif interest_keywords %}
        <div class="recommended-empty">
          <p>관심 태그와 연결된 자격증을 아직 찾지 못했어요. 더 많은 데이터를 준비하는 중이에요.</p>
        </div>
      {% else %}
        <div class="recommended-empty">
          <p>관심 태그를 등록하면 맞춤 추천 자격증을 확인할 수 있어요.</p>
          <a class="btn secondary" href="{% url 'mypage' %}">관심 태그 등록하기</a>
        </div>
      {% endif %}
    </section>
  {% endif %}

  <section class="section" id="rank-section">
    <div class="section-head">
      <div class="section-title-group">
        <span
          class="metric-info metric-info--standalone"
          data-role="rank-tooltip"
          data-tip="1차 시험 응시자 수 1,000명 이상 자격증을 기준으로 집계했어요."
        >
          <button
            type="button"
            class="metric-tip"
            aria-label="랭킹 안내 보기"
            aria-expanded="false"
          >!</button>
        </span>
        <h3 class="section-title">랭킹</h3>
      </div>
      <span class="section-aside">실시간 트렌드</span>
    </div>

    <div class="tabs" role="tablist" aria-label="랭킹 카테고리">
      <button id="tab-hot" class="tab" role="tab" aria-selected="true" aria-controls="panel-hot">지금 핫한 자격증</button>
      <button id="tab-pass" class="tab" role="tab" aria-selected="false" aria-controls="panel-pass">합격률이 높은 자격증</button>
      <button id="tab-pass-low" class="tab" role="tab" aria-selected="false" aria-controls="panel-pass-low">합격률이 낮은 자격증</button>
      <button id="tab-hard" class="tab" role="tab" aria-selected="false" aria-controls="panel-hard">난이도 높은 자격증</button>
      <button id="tab-easy" class="tab" role="tab" aria-selected="false" aria-controls="panel-easy">난이도 쉬운 자격증</button>
    </div>

    <section id="panel" aria-live="polite">
      <div id="list" class="list"></div>
    </section>
  </section>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/home.js' %}"></script>
{% endblock %}
