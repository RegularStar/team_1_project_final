{% extends 'base.html' %}
{% load static %}

{% block title %}SkillBridge 홈{% endblock %}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/home.css' %}" />
{% endblock %}

{% block content %}
  <section class="hero">
    <h2>SkillBridge에 오신 것을 환영합니다.</h2>
    <p>채용공고를 입력하고, 필요한 자격증을 확인해보세요.</p>
    <div class="cta">
      <a class="btn" href="{% url 'job_recommendation' %}">채용공고로 자격증 검색하기</a>
      <a class="btn secondary" href="{% url 'search' %}">자격증 탐색</a>
    </div>
  </section>

  {% if user.is_authenticated %}
    <section class="section section--recommended" id="recommended">
      <div class="section-head">
        <div class="section-title-group">
          <h3 class="section-title">맞춤 추천 자격증</h3>
          {% if interest_keywords %}
            <span class="recommended-keywords">
              {% for tag in interest_keywords|slice:":3" %}
                #{{ tag }}{% if not forloop.last %}, {% endif %}
              {% endfor %}
              {% if interest_keywords|length > 3 %}
                외 {{ interest_keywords|length|add:"-3" }}개
              {% endif %}
            </span>
          {% endif %}
        </div>
        <span class="section-aside">관심 태그 기반 추천</span>
      </div>

      {% if recommended_certificates %}
        <div class="recommended-grid">
          {% for cert in recommended_certificates %}
            <a class="recommended-card" href="/certificates/{{ cert.slug }}/">
              <div class="recommended-card__header">
                <span class="recommended-card__rank">#{{ forloop.counter }}</span>
                {% if cert.match_count %}
                  <span class="recommended-card__match">관심 태그 {{ cert.match_count }}개 일치</span>
                {% endif %}
              </div>
              <h4 class="recommended-card__title">{{ cert.name }}</h4>
              {% if cert.rating is not None %}
                <span class="recommended-card__metric">난이도 {{ cert.rating }}/10</span>
              {% endif %}
              {% if cert.matched_tags %}
                <div class="recommended-card__tags">
                  {% for tag in cert.matched_tags %}
                    <span class="recommended-tag recommended-tag--focus">#{{ tag }}</span>
                  {% endfor %}
                </div>
              {% endif %}
              {% if cert.other_tags %}
                <div class="recommended-card__tags recommended-card__tags--secondary">
                  {% for tag in cert.other_tags %}
                    <span class="recommended-tag">#{{ tag }}</span>
                  {% endfor %}
                </div>
              {% endif %}
            </a>
          {% endfor %}
        </div>
      {% elif interest_keywords %}
        <div class="recommended-empty">
          <p>관심 태그와 연결된 자격증을 아직 찾지 못했어요. 더 많은 데이터를 준비하는 중이에요.</p>
        </div>
      {% else %}
        <div class="recommended-empty">
          <p>관심 태그를 등록하면 맞춤 추천 자격증을 확인할 수 있어요.</p>
          <a class="btn secondary" href="{% url 'mypage' %}">관심 태그 등록하기</a>
        </div>
      {% endif %}
    </section>
  {% endif %}

  <section class="section section--insight" id="insight-highlights">
    <div class="section-head">
      <div class="section-title-group">
        <h3 class="section-title">데이터 하이라이트</h3>
        <span class="section-aside">주목해야할 통계 포인트</span>
      </div>
    </div>
    <div class="insight-carousel">
      <p id="insight-status" class="insight-status" role="status">데이터를 불러오는 중이에요.</p>
      <div id="insight-track" class="insight-track" aria-live="polite"></div>
      <div class="insight-nav" id="insight-nav" hidden>
        <button type="button" class="insight-nav__btn" data-role="insight-prev" aria-label="이전 인사이트 보기">&lt;</button>
        <button type="button" class="insight-nav__btn" data-role="insight-next" aria-label="다음 인사이트 보기">&gt;</button>
      </div>
      <div id="insight-dots" class="insight-dots" aria-label="인사이트 선택"></div>
    </div>
  </section>

  <section class="section section--insight section--badges" id="badge-section">
    <div class="section-head">
      <div class="section-title-group">
        <h3 class="section-title">자격증 도장깨기</h3>
        <span class="section-aside">최상급 자격증 묶음을 한 번에 살펴보세요.</span>
      </div>
      <div class="badge-select">
        <label class="badge-select__label" for="badge-filter">분류</label>
        <select id="badge-filter" class="badge-select__control" aria-label="자격증 도장깨기 분류"></select>
      </div>
    </div>
    <div id="badge-status" class="insight-empty">데이터를 불러오는 중이에요.</div>
    <div id="badge-list" class="insight-cards insight-cards--badges" hidden>
    </div>
  </section>

  <section class="section" id="rank-section">
    <div class="section-head">
      <h3 class="section-title">자격증 랭킹</h3>
      <span class="section-aside">실시간 트렌드</span>
    </div>

    <p class="rank-note">
      응시자수가 1,000명 이상인 자격증만을 랭킹했어요. 느낌표 버튼을 누르면 추가 정보를 확인할 수 있어요.
    </p>

    <div class="tabs" role="tablist" aria-label="랭킹 카테고리">
      <button
        id="tab-hot"
        class="tab"
        role="tab"
        aria-selected="true"
        aria-controls="panel-hot"
        data-role="tab-tip"
        data-tip="각 시험 차수별 응시자가 많은 순서대로 보여드려요."
      >
        핫한 자격증
      </button>
      <button
        id="tab-pass"
        class="tab"
        role="tab"
        aria-selected="false"
        aria-controls="panel-pass"
        data-role="tab-tip"
        data-tip="각 시험 차수별 합격률이 높은 순서대로 보여드려요."
      >
        합격률이 높은 자격증
      </button>
      <button
        id="tab-pass-low"
        class="tab"
        role="tab"
        aria-selected="false"
        aria-controls="panel-pass-low"
        data-role="tab-tip"
        data-tip="각 시험 차수별 합격률이 낮은 순서대로 보여드려요."
      >
        합격률이 낮은 자격증
      </button>
      <button
        id="tab-hard-official"
        class="tab"
        role="tab"
        aria-selected="false"
        aria-controls="panel-hard-official"
        data-role="tab-tip"
        data-tip="공식 난이도란 SkillBridge가 AI(ChatGPT 등)을 활용해 산출한 난이도예요. 난이도가 어려운 순서대로 보여드려요."
      >
        난이도 높은 자격증
      </button>
      <button
        id="tab-easy-official"
        class="tab"
        role="tab"
        aria-selected="false"
        aria-controls="panel-easy-official"
        data-role="tab-tip"
        data-tip="공식 난이도란 SkillBridge가 AI(ChatGPT 등)을 활용해 산출한 난이도예요. 난이도가 쉬운 순서대로 보여드려요."
      >
        난이도 쉬운 자격증
      </button>
      <button
        id="tab-hard-user"
        class="tab"
        role="tab"
        aria-selected="false"
        aria-controls="panel-hard-user"
        data-role="tab-tip"
        data-tip="사용자 난이도란 시험 응시자가 직접 체감한 난이도예요. 공식 난이도와 동일한 10점 척도를 사용하고, 어려운 순서대로 보여드려요."
      >
        사용자 난이도 높은 자격증
      </button>
      <button
        id="tab-easy-user"
        class="tab"
        role="tab"
        aria-selected="false"
        aria-controls="panel-easy-user"
        data-role="tab-tip"
        data-tip="사용자 난이도란 시험 응시자가 직접 체감한 난이도예요. 공식 난이도와 동일한 10점 척도를 사용하고, 쉬운 순서대로 보여드려요."
      >
        사용자 난이도 낮은 자격증
      </button>
    </div>

    <section id="panel" aria-live="polite">
      <div id="list" class="list"></div>
    </section>
    <div class="rank-actions">
      <button id="rank-load-more" type="button" class="rank-load-more" aria-label="랭킹 더 보기">더 보기</button>
    </div>
  </section>
{% endblock %}

{% block extra_js %}
  <script src="{% static 'js/home.js' %}"></script>
{% endblock %}
